class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& v) {
        int n = v.size(); 
        vector<int> ans(n), dp(n + 1, INT_MAX); 
        dp[0] = INT_MIN;
        for(int i = 0;i < n;i++){
            int idx = upper_bound(dp.begin(),dp.end(),v[i]) - dp.begin() ; 
            if(v[i] >= dp[idx-1] && v[i] < dp[idx] ) dp[idx] = v[i];
            ans[i] = idx; 
        } 
        return ans;
    }
};