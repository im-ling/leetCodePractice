class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& a) {
        int n = a.size();
        vector <int> dp, res(n);
        for(int i = 0; i<n; i++) {
            int k = upper_bound(dp.begin(), dp.end(), a[i])-dp.begin();
            if(k >= dp.size()) dp.push_back(a[i]);
            else dp[k] = a[i];
            res[i] = k+1;
        }
        return res;
    }
};