class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
        vector<int> a;
        vector<int> ret;
        for(int v : obstacles) {
            int p = upper_bound(a.begin(), a.end(), v) - a.begin();
            if(p >= a.size()) a.push_back(v);
            else a[p] = v;
            ret.push_back(p + 1);
        }
        return ret;
    }
};