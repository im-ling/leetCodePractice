#include <iostream>
#include <algorithm>
#include <queue>
#include <vector>

using namespace std;

class Solution
{
public:
	vector<int> longestObstacleCourseAtEachPosition(vector<int> &a)
	{
		int n = a.size();

		int *q = new int[n + 1];
		vector<int> ans(n);

		int len = 0;
		for (int i = 0; i < n; i++)
		{
			int l = 0, r = len;
			while (l < r)
			{
				int mid = l + r + 1 >> 1;
				//mid有可能就是答案
				if (q[mid] <= a[i])
					l = mid;
				else
					r = mid - 1;
			}
			len = max(len, r + 1);
			//用r更新	求的是在哪个长度后面更新
			q[r + 1] = a[i];
            
			ans[i] = r + 1;
		}
		return ans;
	}
};