class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& o) {
        int n = o.size(), a = 0;
        vector<int> h(n+1), ans(n); h[0] = 0;
        for(int i =0;i<n;++i){
            if(o[i] >= h[a]){
                h[++a] = o[i];
                ans[i] = a;
                continue;
            }
            int b = a;
            for(; h[b-1] > o[i]; )--b;
            h[b] = o[i];
            ans[i] = b;
        }
        return ans;
    }
};