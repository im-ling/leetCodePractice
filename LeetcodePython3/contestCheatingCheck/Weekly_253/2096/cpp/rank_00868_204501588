class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
        int n = obstacles.size();
        vector<int> answer(n, 10000000);
        vector<int> min_elem(n+1, 10000010);
        for(int j = 0; j < n; ++j) {
            int x = obstacles[j];
            auto iter = upper_bound(min_elem.begin(), min_elem.end(), x);
            *iter = x;
            answer[j] = iter - min_elem.begin() + 1;
        }
        return answer;
    }
};