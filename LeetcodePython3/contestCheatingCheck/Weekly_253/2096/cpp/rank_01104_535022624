class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
        vector<int> res;
        res.reserve(obstacles.size());
        
        int k = 0, N = obstacles.size();
        for (int i = 0; i < N; i++) {
            int j = upper_bound(obstacles.begin(), obstacles.begin()+k, obstacles[i])-obstacles.begin();
            if (j == k) k++;
            obstacles[j] = obstacles[i];
            res.push_back(j+1);
        }
        
        return res;
    }
};