class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
        int n(obstacles.size());
        vector<int> LIS(n, 0);
        
        vector<int> ans;
        int len{0};
        for(auto& e: obstacles) {
            int index = upper_bound(LIS.begin(), LIS.begin() + len, e) - LIS.begin();
            LIS[index] = e;
            if (index == len) ++len;
            ans.emplace_back(index + 1);
        }
        return ans;
    }
};