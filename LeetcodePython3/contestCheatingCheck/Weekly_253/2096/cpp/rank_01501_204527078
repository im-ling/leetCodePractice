#include<vector>
#include<map>
#include<algorithm>
using namespace std;
class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
        // int n=obstacles.size();
        vector<int> ans;
        vector<int> piles;
        for(auto& obs:obstacles){
            auto index=upper_bound(piles.begin(),piles.end(),obs);
            ans.emplace_back(index-piles.begin()+1);

            if(index==piles.end()){
                piles.emplace_back(obs);
                
            }
            else
                *index=obs;
        }
        return ans;

    }
};