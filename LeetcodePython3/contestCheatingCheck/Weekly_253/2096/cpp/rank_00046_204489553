/**
 * @author yuzining
 * @date 2021/08/08 10:40"
 */

#ifdef local
# include "D:\VSCODE\debug.hpp"
#else
#define DEBUG(...) do { } while(false)
#endif

class Solution {
public:
  std::vector<int> longestObstacleCourseAtEachPosition(std::vector<int>& obstacles) {
    const int n = obstacles.size();
    if (n == 0) {
      return std::vector<int>();
    }
    std::vector<int> a;
    a.push_back(obstacles[0]);
    std::vector<int> b(n);
    b[0] = 1;
    for (int i = 1; i < n; i++) {
      if (obstacles[i] >= a.back()) {
        b[i] = (int)a.size() + 1;
        a.push_back(obstacles[i]);
      } else {
        int id = std::upper_bound(a.begin(), a.end(), obstacles[i]) - a.begin();
        a[id] = obstacles[i];
        b[i] = id + 1;
      }
    }
    return b;
  }
};

#ifdef local
void Main() {
  Solution o;
  DEBUG(o.solve(...));
}
#endif