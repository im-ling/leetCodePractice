class Solution {
public:
    vector<int> longestObstacleCourseAtEachPosition(vector<int>& a) {
        int N = a.size();
        int dp[N + 1];
        for(int i=0;i<=N;++i)dp[i]=INT_MAX;
        dp[0]=0;
        vector<int> ans(N);
        for(int i=0;i<N;++i)
        {
            int p = upper_bound(dp,dp+N+1,a[i]) - dp;
            if(a[i]>=dp[p-1] and dp[p]>a[i])dp[p]=a[i];
            ans[i] = p;
            
        }
        return ans;
    }
};