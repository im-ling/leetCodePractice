class Solution {
    public int[] longestObstacleCourseAtEachPosition(int[] obstacles) {
        TreeMap<Integer, Integer> map = new TreeMap<>();
        
        int[] ret = new int[obstacles.length];
        
        for(int i = 0; i < obstacles.length; i++){
            Integer target = map.floorKey(obstacles[i]);
            int ans = 1;
            if(target != null){
                ans = map.get(target) + 1;
            }
            
            map.put(obstacles[i], ans);
            // cleaning phase?
            
            while((target = map.higherKey(obstacles[i])) != null){
                if(map.get(target) <= ans){
                    map.remove(target);
                }
                else break;
            }
            
            
            ret[i] = ans;
        }
        return ret;
    }
}