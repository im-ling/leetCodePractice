class Solution:
    def longestObstacleCourseAtEachPosition(self, obstacles: List[int]) -> List[int]:
        
        res = [1]
        LIS_ending = [obstacles[0]]  # increasing: >=
        
        for i in range(1, len(obstacles)):
            if obstacles[i] >= LIS_ending[-1]:
                LIS_ending.append(obstacles[i])
                res.append(len(LIS_ending))
                continue
            
            left, right = 0, len(LIS_ending)-1
            while left < right:
                mid = (left + right) // 2
                if LIS_ending[mid] <= obstacles[i]:
                    left = mid + 1
                else:
                    right = mid
            LIS_ending[left] = obstacles[i]
            res.append(left + 1)
            
        return res
        
        