class Solution:
    def longestObstacleCourseAtEachPosition(self, nums: List[int]) -> List[int]:
        out = [1]
        dp = [nums[0]]
        for i in range(1, len(nums)):
            n = bisect.bisect_right(dp, nums[i])
            out.append(n + 1)
            if n < len(dp) and nums[i] <= dp[n]:
                dp[n] = nums[i]
            else:
                dp.append(nums[i])
        return out