class Solution {
public:
  vector<int> longestObstacleCourseAtEachPosition(vector<int>& obstacles) {
    vector<int> A;
    vector<int> ans;
    for (auto o: obstacles) {
      auto it = upper_bound(A.begin(), A.end(), o);
      ans.push_back(it-A.begin()+1);
      if (it == A.end())  A.push_back(o);
      else *it = o;
    }
    return ans;
  }
};