class Solution(object):
    def longestObstacleCourseAtEachPosition(self, obstacles):
        """
        :type obstacles: List[int]
        :rtype: List[int]
        """
        n = len(obstacles)
        res = [1] * n
        stk = [obstacles[0]]
        for i in range(1, n):
            if obstacles[i] >= stk[-1]:
                stk.append(obstacles[i])
                idx = len(stk) - 1
            else:
                idx =  bisect.bisect_right(stk, obstacles[i])
                stk[idx] = obstacles[i]
            res[i] = idx + 1
        return res